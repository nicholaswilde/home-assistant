{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home Assistant","text":"<p>My Home Assistant backup.</p>"},{"location":"#tldr","title":"TL;DR","text":"<p>Code</p> TaskManual <pre><code>task up-d\n</code></pre> <pre><code>cp .env.tmpl .env\n# Update .env\n# Update .sop.yaml to include the age public key id\ndocker compose up -d\n</code></pre>"},{"location":"#background","title":"Background","text":"<p>My home automation journey has been quite long. I started off with a z-wave stick that used with a software package that I can't remember.</p>"},{"location":"#smartthings","title":"SmartThings","text":"<p>I then moved over to SmartThings when it was first created as a Kickstarter project. That opened my world into home automation and my investment into devices.</p> <p>Creating custom devices was a bit difficult due to the programming language.</p> <p>After SmartThings was bought by Samsung, I didn't do much with home automation.</p>"},{"location":"#home-assistant_1","title":"Home Assistant","text":"<p>I started using Home Assistant for all of it's third party integrations. I kept my z-wave and zigbee devices on SmartThings and integrated SmartThings and Home Assistant together.</p> <p>I've since moved over to Home Assistant completely, which has been great and pretty seamless.</p>"},{"location":"#license","title":"License","text":"<p>\u200b\u200bApache License 2.0</p>"},{"location":"#author","title":"\u200bAuthor","text":"<p>\u200bThis project was started in 2023 by \u200bNicholas Wilde\u200b.</p>"},{"location":"#references","title":"References","text":"<ul> <li>https://docs.techdox.nz/</li> </ul>"},{"location":"hardware/","title":"Hardware","text":"","tags":["hardware"]},{"location":"hardware/#intel-nuc","title":"Intel NUC","text":"<p>I used to run HA on a bare-metal NUC running Ubuntu Server, but a lot of computing potential was wasted on the NUC.</p>","tags":["hardware"]},{"location":"hardware/#raspberry-pi-4-8gb","title":"Raspberry Pi 4 8GB","text":"<p>I have since moved over to a dedicated Raspberry Pi 4 8GB running Raspberry Pi OS. This, too, may be underutilized.</p> <p>This is a repurposed Raspberry Pi.</p>","tags":["hardware"]},{"location":"hardware/#home-assistant-yellow","title":"Home Assistant Yellow","text":"<p>I know that that the Home Assistant Yellow exists, but just haven't looked into it.</p>","tags":["hardware"]},{"location":"hardware/#devices","title":"Devices","text":"<ul> <li>SkyConnect (ZigBee)</li> <li>NooElec NESDR Mini 2 SDR &amp; DVB-T USB Stick (RTL2832 + R820T2)</li> <li>Aeotec Range Extender 7 (Z-Wave)</li> <li>Minoston Z-Wave Outlet Mini Plug-in Socket</li> <li>Innr Zigbee Smart Plugs</li> <li>GE Enbrighten Z-Wave Plus Smart Light Switch</li> <li>Enbrighten 14298 Z-Wave Plus Plug-In Outdoor Smart Switch, Gen5</li> <li>Aeotec Recessed Door Sensor Gen5</li> <li>GE 12730 Z-Wave Smart Fan Control</li> <li>Aeon Labs Aeotec Z-Wave Door/Window Sensor, 2<sup>nd</sup> Edition</li> <li>Aqara Door and Window</li> <li>Enbrighten Zigbee Smart Light Switch Outdoor Plug-In</li> </ul>","tags":["hardware"]},{"location":"hardware/#references","title":"References","text":"","tags":["hardware"]},{"location":"home-assistant/","title":"Home Assistant","text":""},{"location":"home-assistant/#docker-compose","title":"Docker Compose","text":"<p>I run HA in a Docker container using Docker compose to enable the ease of updating via Renovate.</p>"},{"location":"home-assistant/#haos","title":"HAOS","text":"<p>I toyed around with moving to HAOS to make it easier to install and manage integratios, but I didn't like the command line.</p>"},{"location":"home-assistant/#config","title":"Config","text":"<p> Default Port: <code>8123</code></p> <pre><code>sudo ls -la /dev/serial/by-id\n</code></pre> Output<pre><code>/dev/serial/by-id//dev/serial/by-id/usb-Nabu_Casa_SkyConnect_v1.0_8aaab0838e91ed1196c1c3d13b20a988-if00-port0\n</code></pre> compose.yaml <pre><code>---\nservices:\n  homeassistant:\n    container_name: homeassistant\n    image: ghcr.io/linuxserver/homeassistant:2025.10.4\n    environment:\n      - PUID=${PUID}\n      - PGID=${PGID}\n    volumes:\n      - ./ha:/config\n      - /etc/localtime:/etc/localtime:ro\n      - /run/dbus:/run/dbus:ro\n      - /dev/serial/by-id/usb-Nabu_Casa_SkyConnect_v1.0_8aaab0838e91ed1196c1c3d13b20a988-if00-port0:/dev/ttyUSB0\n    devices:\n      - /dev/ttyUSB0:/dev/ttyUSB0\n      # - /dev/ttyUSB1:/dev/ttyUSB1\n    restart: unless-stopped\n    privileged: true\n    # network_mode: host\n    networks:\n      - localnet\n    depends_on:\n      - esphome\n      - mosquitto\n      - rtl433\n      - zwave-js-ui\n    ports:\n      - 8123:8123\n</code></pre>"},{"location":"home-assistant/#notes","title":"Notes","text":"<ul> <li>Remove unwanted entities - <code>Development tools</code> \u2192 <code>Services</code> \u2192 <code>recorder.purge_entities</code></li> <li>Remove ZHA device</li> <li>Copy <code>Settings</code> \u2192 <code>Devices &amp; services</code> \u2192 <code>Zigbee Home Automation</code> \u2192 <code>&lt;Device&gt;</code> \u2192 <code>Device info</code> \u2192 <code>Zigbee info</code> \u2192 <code>IEEE</code></li> <li><code>Development tools</code> \u2192 <code>Services</code> \u2192 <code>zha.remove</code></li> <li>List all entities <code>Template</code> \u2192 <code>{{ states | map(attribute='entity_id') | list | join('\\n') }}</code></li> </ul>"},{"location":"home-assistant/#upgrade","title":"Upgrade","text":"<p>Code</p> TaskManual <pre><code>task upgrade\n</code></pre> <pre><code>\n</code></pre>"},{"location":"home-assistant/#references","title":"References","text":""},{"location":"tags/","title":"Tags","text":"<p>Following is a list of relevant tags:</p>","tags":["reference"]},{"location":"tags/#tag:add-on","title":"add-on","text":"<ul> <li>            ESPHome          </li> <li>            Eclipse Mosquitto          </li> <li>            Z-Wave JS UI          </li> <li>            rtl_434          </li> </ul>","tags":["reference"]},{"location":"tags/#tag:hardware","title":"hardware","text":"<ul> <li>            Hardware          </li> </ul>","tags":["reference"]},{"location":"tags/#tag:integration","title":"integration","text":"<ul> <li>            Automations          </li> </ul>","tags":["reference"]},{"location":"tags/#tag:tools","title":"tools","text":"<ul> <li>            SOPS          </li> </ul>","tags":["reference"]},{"location":"add-on/eclipse-mosquitto/","title":"Eclipse Mosquitto","text":"<p>Eclipse Mosquitto is an open source (EPL/EDL licensed) message broker that implements the MQTT protocol. </p> <p>I use it to extract devices from <code>rtl_433</code>.</p>","tags":["add-on"]},{"location":"add-on/eclipse-mosquitto/#config","title":"Config","text":"<p> Web port: <code>9001</code></p> <p> Interface port: <code>1883</code></p> <p>User: <code>mosquitto</code></p> <p>UID: <code>1883</code></p> <p>Group: <code>mosquitto</code></p> <p>GID: <code>1883</code></p> compose.yaml <pre><code>  mosquitto:\n    image: eclipse-mosquitto:2.0.22\n    container_name: mosquitto\n    volumes:\n      - ./mosquitto:/mosquitto\n      - ./mosquitto/data:/mosquitto/data\n      - ./mosquitto/log:/mosquitto/log\n      - ./mosquitto/config:/mosquitto/config\n      - /etc/localtime:/etc/localtime:ro\n      - ./mosquitto/config/password.txt:/mosquitto/config/password.txt\n    ports:\n      - 1883:1883\n      - 9001:9001\n    restart: unless-stopped\n    networks:\n      - localnet\n</code></pre>","tags":["add-on"]},{"location":"add-on/eclipse-mosquitto/#permissions","title":"Permissions","text":"<p>By default, the <code>eclipse-mosquitto</code> Docker image is run using the <code>mosquitto:mosquitto</code> <code>1883:1883</code> <code>user</code> and <code>group</code>.</p> <p>To be able to edit the config file using the current user on the host, the mosquitto group needs to be added to the host system and the host user needs to be added to the group.</p> <p>Add the mosquitto group</p> Host<pre><code>sudo groupadd -g 1883 mosquitto\n</code></pre> <p>Add current user to the mosquitto group</p> Host<pre><code>sudo usermod -aG mosquitto $(whoami)\n</code></pre> <p>Check</p> Host<pre><code>cat /etc/group | grep 1883\n</code></pre> Output<pre><code>mosquitto:x:1883:username\n</code></pre>","tags":["add-on"]},{"location":"add-on/eclipse-mosquitto/#setup-directories","title":"Setup Directories","text":"<p>Make directories</p> Host<pre><code>mkdir -p ./mosquitto/config ./mosquitto/data ./mosquitto/log\n</code></pre> <p>Grant group write</p> Host<pre><code>sudo chmod -R g+w ./mosquitto\n</code></pre> <p>Change folder permissions</p> Host<pre><code>sudo chown -R 1883:1883 ./mosquitto\n</code></pre>","tags":["add-on"]},{"location":"add-on/eclipse-mosquitto/#credentials","title":"Credentials","text":"<p>Generate <code>username</code> and <code>password</code> for mosquitto.</p> <p>./mosquitto/config/password.txt</p> Host<pre><code>sudo touch ./mosquitto/config/password.txt\ndocker compose up mosquitto -d\n</code></pre> HostDocker container Host<pre><code>docker exec -it mosquitto mosquitto_passwd -c /mosquitto/config/password.txt username\n</code></pre> Host<pre><code>docker exec -it mosquitto sh\n</code></pre> Docker container<pre><code>mosquitto_passwd -c /mosquitto/config/password.txt username\nchown root:root /mosquitto/config/password.txt\nexit \n</code></pre> <p>Change permissions again</p> Host<pre><code>sudo chown -R 1883:1883 ./mosquitto\n</code></pre> <p>Check</p> HostDocker container <pre><code>sudo cat ./mosquitto/config/password.txt\n</code></pre> <pre><code>docker exec -it mosquitto cat /mosquitto/config/password.txt\n</code></pre> Output<pre><code>username:$7$101$o0s01iFdr/lPCuvc$HEUdUhd50k212ZV/B9bjLYb/iKC6R+4srHgVz+3LbIebVavtD+5uRumiEOZGZOdy5LNq/siDdlxXxomOM8u3jA==\n</code></pre> <p>Stop the container</p> Host<pre><code>docker compose down mosquitto\n</code></pre> <p>Check that it's not running</p> Host<pre><code>docker container ps\n</code></pre> Output<pre><code>CONTAINER ID    IMAGE    COMMAND    CREATED   STATUS  PORTS   NAMES\n</code></pre>","tags":["add-on"]},{"location":"add-on/eclipse-mosquitto/#home-assistant","title":"Home Assistant","text":"<p>Note</p> <p>The <code>Broker</code> should match the container name of Eclipse Mosquitto and the <code>username</code> and <code>password</code> should match the generated ones above.</p> MQTT <p>Broker: <code>mosquitto</code></p> <p>Port: <code>1883</code></p> <p>Username: <code>username</code></p> <p>Password: <code>password</code></p>","tags":["add-on"]},{"location":"add-on/eclipse-mosquitto/#references","title":"References","text":"<ul> <li>https://mosquitto.org/</li> <li>https://www.home-assistant.io/integrations/mqtt/</li> </ul>","tags":["add-on"]},{"location":"add-on/esphome/","title":"ESPHome","text":"<p>ESPHome is used to connect my custom IoT devices to Home Assistant.</p> <p>I prefer to use ESP32 devices over ESP8266.</p>","tags":["add-on"]},{"location":"add-on/esphome/#config","title":"Config","text":"<p> Default Port: <code>6052</code></p> compose.yaml <pre><code>  esphome:\n    container_name: esphome\n    image: ghcr.io/esphome/esphome:2025.10.3\n    volumes:\n      - ./esphome:/config\n      - /etc/localtime:/etc/localtime:ro\n    restart: unless-stopped\n    privileged: true\n    networks:\n      - localnet\n    ports:\n      - 6052:6052\n    # network_mode: host\n</code></pre>","tags":["add-on"]},{"location":"add-on/esphome/#home-assistant","title":"Home Assistant","text":"<p>Note</p> <p>The <code>Host</code> should match the container name of ESPHome.</p> ESPHome <p>Host: <code>esphome</code></p> <p>Port: <code>6052</code></p>","tags":["add-on"]},{"location":"add-on/esphome/#devices","title":"Devices","text":"","tags":["add-on"]},{"location":"add-on/esphome/#water-heater-monitor","title":"Water Heater Monitor","text":"<p>I have added a device to monitor my water heater pilot to ensure that the pilot is still lit. I had an issue where my water heater thermocouple malfunctioned which caused my pilot light to go out.</p>","tags":["add-on"]},{"location":"add-on/esphome/#future","title":"Future","text":"<p>Future planned devices.</p>","tags":["add-on"]},{"location":"add-on/esphome/#water-level-sensor","title":"Water Level Sensor","text":"<p>I have an indoor plant grower that runs out of water.</p> <p>Create a sensor to send a notification when the water level is low.</p>","tags":["add-on"]},{"location":"add-on/esphome/#references","title":"References","text":"<ul> <li>https://esphome.io/</li> <li>https://www.home-assistant.io/integrations/esphome/</li> </ul>","tags":["add-on"]},{"location":"add-on/rtl_433/","title":"rtl_433","text":"<p><code>rtl_433</code> is a generic data receiver, mainly for the 433.92 MHz, 868 MHz (SRD), 315 MHz, 345 MHz, and 915 MHz ISM bands and is used to read devices.</p> <p>I use this with Eclipse Mosquitto to connect 433 devices to Home Assistant.</p>","tags":["add-on"]},{"location":"add-on/rtl_433/#hardware","title":"Hardware","text":"<ul> <li><code>NooElec NESDR Mini 2 SDR &amp; DVB-T USB Stick (RTL2832 + R820T2)</code></li> </ul>","tags":["add-on"]},{"location":"add-on/rtl_433/#config","title":"Config","text":"<p>Find the USB device <code>idVendor</code> and <code>idProduct</code></p> <pre><code>sudo lsusb\n</code></pre> Output<pre><code>Bus 001 Device 003: ID 0bda:2838 Realtek Semiconductor Corp. RTL2838 DVB-T\n</code></pre> <p>/etc/udev/rules.d/99-rtl433.rules</p> <pre><code>SUBSYSTEM==\"usb\", ATTRS{idVendor}==\"0bda\", ATTRS{idProduct}==\"2838\", SYMLINK+=\"rtl433\"\n</code></pre> <p>Code</p> <pre><code>(\n  udevadm control --reload-rules \n  udevadm trigger\n)\n</code></pre> <p>Check that the device exists</p> <pre><code>ls /dev\n</code></pre> Output<pre><code>rtl433\n</code></pre> <p>Add the dev location, <code>Bus</code> and <code>Device</code> to <code>devices</code>.</p> <p>compose.yaml</p> <pre><code>services:\n  rtl433:\n    devices:\n      - /dev/rtl433:/dev/bus/usb/001/003\n</code></pre> compose.yaml <pre><code>  rtl433:\n    image: hertzg/rtl_433:25.02\n    container_name: rtl433\n    devices:\n      - /dev/rtl433:/dev/bus/usb/001/004\n    command:\n      - \"-Mtime:unix:usec:utc\"\n      - \"-Fmqtt://mosquitto:1883,retain=1,user=${RTL_USER},pass=${RTL_PASS},events=rtl_433[/model][/id]\"\n      - \"-Ccustomary\"\n      - \"-f915M\"\n      - \"-f433.9M\"\n    restart: unless-stopped\n    networks:\n      - localnet\n    # network_mode: host\n</code></pre>","tags":["add-on"]},{"location":"add-on/rtl_433/#troubleshooting","title":"Troubleshooting","text":"<p>MQTT</p> Configure <p>Listen to a topic: <code>rtl_433/#</code></p> <p><code>| Start listening |</code></p>","tags":["add-on"]},{"location":"add-on/rtl_433/#references","title":"References","text":"<ul> <li>https://github.com/hertzg/rtl_433_docker/issues/14#issuecomment-868524131</li> </ul>","tags":["add-on"]},{"location":"add-on/zwave-js-ui/","title":"Z-Wave JS UI","text":"","tags":["add-on"]},{"location":"add-on/zwave-js-ui/#hardware","title":"Hardware","text":"<ul> <li>Zooz 800 Series Z-Wave Long Range S2 USB Stick ZST39 LR</li> <li>Aeotec Range Extender 7 (Z-Wave)</li> </ul>","tags":["add-on"]},{"location":"add-on/zwave-js-ui/#config","title":"Config","text":"<p> Default Port: <code>3000</code></p> <p>Find USB device ID</p> <pre><code>sudo ls -la /dev/serial/by-id\n</code></pre> Output<pre><code>/dev/serial/by-id/usb-Zooz_800_Z-Wave_Stick_533D004242-if00\n</code></pre> <p>Add the device ID to <code>devices</code>.</p> compose.yaml <pre><code>  zwave-js-ui:\n    container_name: \"zwave-js-ui\"\n    image: \"zwavejs/zwave-js-ui:11.6.1\"\n    tty: true\n    stop_signal: SIGINT\n    devices:\n      - \"/dev/serial/by-id/usb-Zooz_800_Z-Wave_Stick_533D004242-if00:/dev/zwave\"\n    environment:\n      - \"SESSION_SECRET=mysupersecretkey\"\n    ports:\n      - \"3000:3000\"\n      - \"8091:8091\"\n    restart: \"always\"\n    volumes:\n      - \"/home/nicholas/git/nicholaswilde/home-assistant/zwave:/usr/src/app/store\"\n      - /var/run/docker.sock:/var/run/docker.sock\n      - /etc/localtime:/etc/localtime:ro\n    working_dir: \"/usr/src/app\"\n    networks:\n      - localnet\n    # network_mode: host\n</code></pre>","tags":["add-on"]},{"location":"add-on/zwave-js-ui/#home-assistant","title":"Home Assistant","text":"<p>Note</p> <p>The hostname in the URL should match the container name of Z-Wave JS.</p> URL <pre><code>ws://zwave-js-ui:3000\n</code></pre>","tags":["add-on"]},{"location":"add-on/zwave-js-ui/#references","title":"References","text":"<ul> <li>https://zwave-js.github.io/zwave-js-ui/</li> <li>https://www.home-assistant.io/integrations/zwave_js/</li> </ul>","tags":["add-on"]},{"location":"integration/automations/","title":"Automations","text":"<p>Automations that I use.</p>","tags":["integration"]},{"location":"integration/automations/#lighting","title":"Lighting","text":"<p>The vast majority of my automations consist of controlling lights around the house.</p>","tags":["integration"]},{"location":"integration/automations/#sunset","title":"Sunset","text":"<p>At sunset, I turn on all of my outdoor lights and some indoor lights, such as kitchen cabinet and mantle lights.</p>","tags":["integration"]},{"location":"integration/automations/#night","title":"Night","text":"<p>At about 10:30 PM I turn off some indoor and outdoor lights, such as the mantle and gazebo lights.</p>","tags":["integration"]},{"location":"integration/automations/#sunrise","title":"Sunrise","text":"<p>At sunrise, I turn off the rest of of my outdoor lights.</p>","tags":["integration"]},{"location":"integration/automations/#closet-pantry","title":"Closet &amp; Pantry","text":"<p>Because my closet and pantry are dark, I need to turn on a light every time I open the doors. </p> <p>I have a zigbee or z-wave light switch that contols the light inside of the room so it can be manually turned on and off.</p> <p>I have a recessed z-wave door sensor that senses when the door is opened, which then turns on the light.</p> <p>the light is also turned off when the door is closed again.</p> <p>The problem with this method is that the door sensor runs on a CR2 battery, which needs to be replaced every once in a while.</p> <p>I can't get my low battery notifications to be consistent and so I rely on observations of when the light doesn't change to tell me that the battery needs to be changed.</p> <p>I do use rechargeable CR2 batteries, which makes it more manageable.</p>","tags":["integration"]},{"location":"integration/automations/#references","title":"References","text":"","tags":["integration"]},{"location":"tools/sops/","title":"SOPS","text":"<p>SOPS is used to encrypt files that contain secrets. The encrypted copy of the file ends in <code>*.enc</code>.</p> <pre><code># sops-age = lpass entry name\n# att-2571789250549588435-38084 = lpass attach id of keys.txt in sops-age entry\nmkdir -p ~/.config/sops/age\nlpass show sops-age --attach=att-2571789250549588435-38084 -q &gt; ~/.config/sops/age/keys.txt\n# or\nage-keygen -o ~/.config/sops/age/keys.txt\nsops -e --input-type yaml --output-type yaml ./ha/secrets.yaml &gt; ./ha/secrets.yaml.enc\nsops -d --input-type yaml --output-type yaml ./ha/secrets.yaml.enc &gt; ./ha/secrets.yaml\n</code></pre>","tags":["tools"]}]}